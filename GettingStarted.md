# Getting Started

## Getting NuKeeper

NuKeeper [can be found on NuGet as a global tool](https://www.nuget.org/packages/NuKeeper/). The [source is on GitHub](https://github.com/NuKeeperDotNet/NuKeeper).

You will first need [.NET Core 2.1 installed](https://www.microsoft.com/net).

Install NuKeeper with:

`dotnet tool install --global NuKeeper`

Update NuKeeper with:

`dotnet tool update --global NuKeeper`

## Examples of using NuKeeper

### Inspect mode

Use inspect mode to show updates that can be applied to a solution.

Inspect the current folder:

````
cd C:\code\MyApp
NuKeeper
````

This produces output e.g.

````

Found 2 package updates
Total package age:
 Days: 12
 LibYears: 0.1

Microsoft.Extensions.Configuration.Json to 2.1.0 from 2.0.2 in 1 place since 13 days ago.
Swashbuckle.AspNetCore to 2.5.0 from 2.4.0 in 1 place since 6 days ago.
````

[LibYear](https://libyear.com/) is "a simple measure of software dependency freshness". [There is a similar tool for .NET](https://stevedesmond.ca/blog/happy-libyear).

`NuKeeper` with no `mode` argument is short for `NuKeeper mode=inspect`

You can inspect a different folder:

````
NuKeeper dir=C:\code\MyApp
````


### Update Mode

Use update mode to apply an update to code.

Apply a update chosen by NuKeeper to a solution:
````
cd C:\code\MyApp
NuKeeper mode=update
````
or


````
NuKeeper mode=update dir=C:\code\MyApp
````

Apply an update to a particular package:
````
NuKeeper mode=update i=SomePackageName
````

See below for more on `i=pattern`.


### Repository mode

Use repository mode to raise multiple pull requests against a GitHub repository. The repository does not need to be present on the file system beforehand. It will be fetched to a temporary folder.

If you run these command lines regularly, you can automatically get update pull requests [like this one](https://github.com/NuKeeperDotNet/NuKeeper/pull/280) and always keep a project's dependencies up to date.

Raising a pull request is intended to hook into the automated tests and manual review process that you use. You can then choose to merge or reject the pull rquest based on the outcome.

In order to work with GitHub repositories, you will first need [a GitHub personal access token](https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/).

````
NuKeeper mode=repository github_repository_uri=https://github.com/NuKeeperDotNet/NuKeeper.git t=mygithubtoken
````

#### Hidden token

The GitHub token is a secret; often you don't want to put it on the command line, e.g. if this command line is in a script stored in a public repository. In that case, you can put it in the environment variable `NuKeeper_github_token` and NuKeeper will automatically read it from there.

````
set NuKeeper_github_token=mygithubtoken
````

#### Custom GitHub API server

If you have a a different GitHub server, e.g. one hosted inside your organisation, you need to find out where its API root URL is. You can specify it to Nukeeper with e.g. `api=https://github.mycompany.com/api/v3`. The default is the public API at `https://api.github.com`

#### Custom NuGet feeds

If you have an internal NugGet package feed, then you can specify a list of NuGet sources on the command line. e.g. `sources=https://api.nuget.org/v3/index.json;http://packages.mycompany.com/nugetfeed`

If you override this, you can chose to include the public `api.nuget.org` feed or not. You may not need to, if your internal feed proxies this.

#### Options for controlling pull requests

NuKeeper often operates in a target-rich environment, where you don't want to raise all the potential pull requests at once.

NuKeeper sorts the pull requests, using heuristics so that more impactful updates are at the top, but you also can control how many pull requests are raised, when and what levels of change.

##### Examples

`maxpr=2` Limit to two pull requests generated by a run. The default value is 3.

`Change=minor` Do not allow major version changes. e.g. version `1.2.3` to `.1.5.0` will be selected even if version `2.0.0` is also available. [Semantic versioning](https://semver.org/ "Semantic Versioning documentation") calls these three numbers `major`, `minor` and `patch` versions. If semantic versioning is being well-used, then breaking changes only appear in major versions.

The default value is `major`.

`age=10d` Do not apply any version change until it has been available for 10 days. The default is 7 days. You can also specify this value in weeks with e.g. `age=6w` or hours with e.g. `age=12h`.

This is a precaution against being on the "bleeding edge" by taking new packages immediately. Sometimes issues are discovered just after package release, and the package is removed or replaced by a `x.0.1` fix release.

#### Include and exclude

Include and exclude package names with `i` and `e`.
e.g. `i=nlog` or `e=aspnet`

Exclude ( `e=pattern` ) specifies that packages that match the pattern will not be applied. Include (`i`) specifies that _only_ packages that match the pattern can be applied.

The patterns are regular expressions. This is not a regular expression tutorial, but it is worth knowing a few common ways to use it:

 * By default, it is substring match. e.g. `i=NLog` will include all package names that contain the text `NLog`.
 * You can [anchor](https://docs.microsoft.com/en-us/dotnet/standard/base-types/anchors-in-regular-expressions) the match with `^` at the start or `$` at the end to ensure that the package name starts and/or ends with the specified text. Using both start and end anchors means that it must be an exact match for the whole package name. e.g. `i=^NLog$` will include only the package `NLog`.
 * You can use `|` as an "or" to match one of several things. However since on the command line the `|` has special meaning to pipe command output, you have to escape it as `^|`. e.g.  exclude updates to framework packages: `e=(Microsoft^|System^|NETStandard^|AspNet)`

### Organisation mode

Use organisation mode to raise multiple pull requests against multiple GitHub repositories within the same [GitHub Organisation](https://help.github.com/articles/about-organizations/).

````
NuKeeper mode=org org=myteam
````

---

For all possible options and modes, see [The ReadMe](README.md)
